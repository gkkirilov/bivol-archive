var give_global_vars,Give_Currency_Switcher,give_cs_json_obj;jQuery.noConflict(),function(e){Give_Currency_Switcher={isMultiStepForm:!1,forms:!1,price_id:"",init:function(){forms=e("form.give-form"),this.init_switcher(),jQuery(document).on("give_donation_value_updated blur",".give-donation-amount",this.remove_sanitize_amount),jQuery(document).on("give_gateway_loaded",this.changed_payment_gateway),jQuery(document).find(".give-donation-amount .give-text-input").on("blur",this.update_donation_amount),e(".give-btn-reveal").on("click",this.handle_reveal_btn),e("body").on("change",".give-cs-select-currency",this.switch_currency),jQuery(document).on("mfpOpen",this.adjust_dropdown_width),jQuery(document).on("click",".give-card",this.adjust_dropdown_width),jQuery(document).on("mfpClose",this.adjust_dropdown_width_after_close)},adjust_dropdown_width_after_close:function(){setTimeout(function(){Give_Currency_Switcher.init_switcher()},10)},init_switcher:function(){forms.each(function(){var r=e(this);if(r.parent().hasClass("give-embed-form")&&(Give_Currency_Switcher.isMultiStepForm=!0,r.attr("data-goal-amount",Number(r.find(".goal .number").text().replace(/[^0-9.-]+/g,""))),r.attr("data-income-amount",Number(r.find(".raised .number").text().replace(/[^0-9]+/g,"")))),Give_Currency_Switcher.module.isCurrencySwitcherEnable(r)){var n=r.find("select.give-cs-select-currency"),t=Give_Currency_Switcher.module.getSupportedCurrencies(r),i=r.find(".give-currency-symbol").text();if("enabled"===Give_Currency_Switcher.module.getValueOf("acronyms",r)){var a=Give.form.fn.getInfo("currency_code",r);i=-1===i.indexOf(a)?Give.form.fn.getInfo("currency_code",r)+" "+i:i}if(Give_Currency_Switcher.module.isCurrencySwitcherEnable(r)&&1<Object.keys(t).length){var o=n.removeClass("give-hidden").addClass("give-cs-mini-dropdown").css({width:r.find(".give-currency-symbol").addClass("give-cs-mini-dropdown-icon").outerWidth()}).clone();"after"===give_global_vars.currency_pos?o.insertAfter(r.find('.give-donation-amount input[name="give-amount"], .give-donation-amount span.give-amount-top')):o.prependTo(r.find(".give-donation-amount")),r.find(".give-currency-symbol").html(i),Give_Currency_Switcher.adjust_dropdown_width(),n.remove()}else Give_Currency_Switcher.module.isCurrencySwitcherEnable(r)&&1===Object.keys(t).length&&r.find(".give-currency-symbol").html(i);Give_Currency_Switcher.module.isGatewaySupportCurrency(r,a)||(Give_Currency_Switcher.module.showCurrencyNotSupportGatewayNotice(r,a),r.find(".give-cs-select-currency").val(a).trigger("change"))}})},adjust_dropdown_width:function(){e("form.give-form").each(function(){var r=e(this);if(Give_Currency_Switcher.module.isCurrencySwitcherEnable(r)){var n=r.find(".give-currency-symbol.give-cs-mini-dropdown-icon").outerWidth();r.find(".give-cs-select-currency").css({width:n});var t=r.find(".give-cs-select-currency").outerWidth();r.find(".give-cs-mini-dropdown").css("marginRight",-Math.abs(t)+"px")}})},handle_reveal_btn:function(){e(this).parents("form").find(".give-currency-switcher-wrap").slideDown()},update_donation_amount:function(r){var n=jQuery(r.currentTarget).closest("form");if(Give_Currency_Switcher.module.isCurrencySwitcherEnable(n)&&!(0>=n.find(".give-cs-select-currency").length)){n.find('input[name="give-cs-custom-amount"]').remove(),Give_Currency_Switcher.module.setValueOf("give-amount",e(this).val(),n),n.find(".give-final-total-amount").attr("data-total",e(this).val());var t=Give.form.fn.getPriceID(n),i=Give_Currency_Switcher.module.getValueOf("give-cs-currency",n),a=JSON.parse(Give.form.fn.getInfo("data-give_cs_base_amounts",n)),o=Give_Currency_Switcher.module.getDonationAmount(n,Give.form.fn.getInfo("decimal_separator",n)),c=Give_Currency_Switcher.module.getExchangeRates(n),u=0!==c[i]?o/c[i]:o;a.custom=0,(-1===t&&parseFloat(a[0])!==parseFloat(u)||"custom"===t&&parseFloat(u)!==parseFloat(a[t]))&&(a.custom=u),n.attr("data-give_cs_base_amounts",JSON.stringify(a)),setTimeout(function(){0<n.find("div.give-invalid-minimum").length?n.find(".give-cs-select-currency").attr("disabled","disabled"):n.find(".give-cs-select-currency").removeAttr("disabled")},400),Give_Currency_Switcher.module.updateCurrencyMessage(n,t),t!==Give_Currency_Switcher.price_id&&(Give_Currency_Switcher.price_id=Give.form.fn.getPriceID(n)),Give_Currency_Switcher.updateMinimumAmount(n,t)}},switch_currency:function(r){var n=e(this).closest("form.give-form");if(Give_Currency_Switcher.module.isCurrencySwitcherEnable(n)){var t=e(this).val(),i=Give_Currency_Switcher.module.getValueOf("give-cs-form-currency",n),a=Give_Currency_Switcher.module.getSupportedCurrencies(n),o=Give.form.fn.getVariablePrices(n);if(null!==t){var c=a[t].currencySetting.symbol||"";if(!Give_Currency_Switcher.module.isGatewaySupportCurrency(n,t))return Give_Currency_Switcher.module.showCurrencyNotSupportGatewayNotice(n,t),n.find(".give-donation-amount .give-text-input").trigger("blur"),void n.find("#give-purchase-button").attr("disabled",!0);n.find(".give-currency-symbol").html("enabled"===Give_Currency_Switcher.module.getValueOf("acronyms",n)?t+" "+c:c);var u=a[t].currencySetting.setting,s=""!==u.thousands_separator?u.thousands_separator:" ",m=""!==u.decimal_separator?u.decimal_separator:".";if(Give.form.fn.setInfo("attr",c,n,"data-currency_symbol"),Give.form.fn.setInfo("attr",t,n,"data-currency_code"),Give.form.fn.setInfo("attr",s,n,"data-thousands_separator"),Give.form.fn.setInfo("attr",m,n,"data-decimal_separator"),Give.form.fn.setInfo("attr",u.number_decimals,n,"data-number_decimals"),Give_Currency_Switcher.module.setValueOf("give-cs-exchange-rate",Give_Currency_Switcher.module.getExchangeRates(n)[t],n),Give_Currency_Switcher.module.setValueOf("give-cs-form-currency",t,n),e(this).closest(".give-display-onpage").find(".give-cs-notices").remove(),t!==i){var d="undefined"!=typeof a[i].currencySetting.setting.decimal_separator?a[i].currencySetting.setting.decimal_separator:".";Give_Currency_Switcher.updateSingleAmount(n,i,d);var v=Give.form.fn.getPriceID(n,!1);(-1<v||"custom"===v)&&Give_Currency_Switcher.updateVariablePrices(n,v,i,o),n.find(".give-donation-amount .give-text-input").trigger("blur"),Give_Currency_Switcher.updateGoalAmount(n,t,d),Give_Currency_Switcher.module.updateCurrencyMessage(n,v),Give_Currency_Switcher.module.updateFeeAmount(i,t,n,d),Give.cache["form_"+Give.form.fn.getInfo("form-id",n)]=[],e(document).trigger("give_cs_switched",n)}}}},updateSingleAmount:function(r,n,t){var i=Give_Currency_Switcher.module.getDonationAmount(r,t),a=Give_Currency_Switcher.module.getValueOf("give-cs-currency",r),o=Give_Currency_Switcher.module.getCustomAmounts(r),c=o[a];c||(c=Give_Currency_Switcher.module.convertCurrency(i,r,n,null,!0)),Give_Currency_Switcher.adjust_dropdown_width();var u=Give.fn.formatCurrency(c,{},r);r.find(".give-amount-top").val(u),r.find("span.give-amount-top").text(u),r.find("span.give-cs-amount-totals").remove(),e("<span/>",{"class":"give-cs-amount-totals","data-total":u,"data-sanitize-amount":c,"data-custom_amount":o[a]?Give_Currency_Switcher.module.convertCurrency(i,r,n):""}).appendTo(r)},updateVariablePrices:function(r,n,t,i){var a=Give_Currency_Switcher.module.getValueOf("give-cs-currency",r),o=[],c=r.find("span.give-cs-variable-amount");e.each(i,function(i,u){var s=u.price_id,m=Give_Currency_Switcher.module.getCustomAmounts(r,s),d=u.amount,v=r.find(".give-donation-levels-wrap [data-price-id="+s+"]"),f=c.length?JSON.parse(decodeURIComponent(c.attr("data-custom_amount"))):[];e.each(f,function(e,r){r[s]&&(d=r[s]["converted-amount"])});var _=m[a]?m[a]:Give_Currency_Switcher.module.convertCurrency(d,r,t,null,!0,s);r.find(".give-donation-levels-wrap [data-price-id="+s+"]").val(Give.fn.formatCurrency(_,{},r));var l=v.hasClass("give-radio-input")?r.find(".give-donation-levels-wrap [data-price-id="+s+"]").closest("li").find("label").html():r.find(".give-donation-levels-wrap [data-price-id="+s+"]").html();if("custom"!==s){var g=jQuery.parseJSON(give_cs_json_obj)["form_"+Give.form.fn.getInfo("form-id",r)].variable_prices[s].has_label;if(Give_Currency_Switcher.isMultiStepForm){var y=Give.form.fn.getInfo("currency_symbol",r),p=Give.form.fn.getInfo("currency_position",r),h=Give.form.fn.getInfo("number_decimals",r),w=Math.round(_,h),G='<div class="currency currency--'+p+'">'+y+"</div>"+w;r.find(".give-donation-levels-wrap").find(".give-btn-level-"+s+', *[for="give-radio-level-'+s+'"], .give-donation-level-'+s).html(G)}else{var w=Give.fn.formatCurrency(_,{symbol:Give.form.fn.getInfo("currency_symbol",r),position:Give.form.fn.getInfo("currency_position",r),precision:Give.form.fn.getInfo("number_decimals",r)},r),C=l.split(", "),S=C.length,G=w;2===S&&(G=w+", "+C[1]),g||r.find(".give-donation-levels-wrap").find(".give-btn-level-"+s+', *[for="give-radio-level-'+s+'"], .give-donation-level-'+s).html(G)}}"custom"!==n&&Give.form.fn.autoSetMultiLevel(r.find(".give-donation-levels-wrap").find('*[data-price-id="'+n+'"]'));var b={};b[s]={"converted-amount":Give_Currency_Switcher.module.convertCurrency(d,r,t),"custom-amount":m[a]},o.push(b)}),0<c.length?c.attr("data-custom_amount",JSON.stringify(o)):e("<span/>",{"class":"give-cs-variable-amount give-hidden","data-custom_amount":JSON.stringify(o)}).appendTo(r)},updateGoalAmount:function(e,r,n){const t=Give.form.fn.getInfo("goal_format",e),i=Give_Currency_Switcher.isMultiStepForm?e.parent().find(".income-stats"):e.parent().find(".give-goal-progress");if("undefined"!==t&&"amount"===t)if(Give_Currency_Switcher.isMultiStepForm){const a=Give_Currency_Switcher.module.getExchangeRates(e),o=0!==a[r]?a[r]:1,c=Give.fn.formatCurrency(e.attr("data-goal-amount")*o,{symbol:Give.form.fn.getInfo("currency_symbol",e),position:Give.form.fn.getInfo("currency_position",e),precision:0},e),u=Give.fn.formatCurrency(e.attr("data-income-amount")*o,{symbol:Give.form.fn.getInfo("currency_symbol",e),position:Give.form.fn.getInfo("currency_position",e),precision:0},e);i.find(".goal .number").text(c),i.find(".raised .number").text(u)}else goalAmounts=JSON.parse(i.find("span.goal-text").attr("data-amounts")),incomeAmounts=JSON.parse(i.find("span.income").attr("data-amounts")),i.find("span.goal-text").text(goalAmounts[r]),i.find("span.income").text(incomeAmounts[r])},updateMinimumAmount:function(e,r){var n=Give_Currency_Switcher.module.getValueOf("give-cs-currency",e),t=Give_Currency_Switcher.module.getCustomAmounts(e,r),i=t[n]||!1,a=Give_Currency_Switcher.module.convertCurrency(Give_Currency_Switcher.module.getDefaultMinimumAmount(e),e,give_global_vars.currency);i&&i<a&&(a=i);var o={symbol:"",decimal:".",thousand:"",precision:Give.form.fn.getInfo("number_decimals",e)};Give_Currency_Switcher.module.setValueOf("give-form-minimum",Give.fn.formatCurrency(a,o,e),e),(form_maximum_amount=Give_Currency_Switcher.module.getDefaultMinimumAmount(e,"max"))&&(form_maximum_amount=Give_Currency_Switcher.module.convertCurrency(form_maximum_amount,e,give_global_vars.currency),i&&i>form_maximum_amount&&(form_maximum_amount=i),Give_Currency_Switcher.module.setValueOf("give-form-maximum",Give.fn.formatCurrency(form_maximum_amount,o,e),e))},changed_payment_gateway:function(r,n,t){var i=jQuery(document).find("form#"+t),a=Give_Currency_Switcher.module.getSupportedCurrencies(i),o=i.find('input[name="give-cs-form-currency"]').val(),c=i.find(".give-cs-select-currency"),u=i.find("span.give-final-total-amount"),s=Give.form.fn.getAmount(i);if(Give_Currency_Switcher.module.isCurrencySwitcherEnable(i)){if(i.find("#give_currency_not_support.give_notice").parent().remove(),i.find(".give-cs-select-currency").empty(),1===Object.keys(a).length?(i.find("span.give-currency-symbol").addClass("give-cs-dropdown-hidden"),i.find('select[name="give-cs-currency"]').addClass("give-cs-remove-cursor").hide(),i.find(".give-cs-mini-dropdown-icon").addClass("give-cs-reset-width")):(i.find("span.give-currency-symbol").removeClass("give-cs-dropdown-hidden"),i.find('select[name="give-cs-currency"]').removeClass("give-cs-remove-cursor").show(),i.find(".give-cs-mini-dropdown-icon").removeClass("give-cs-reset-width")),Give_Currency_Switcher.init_switcher(),Object.keys(a).forEach(function(r){if(-1!==e.inArray(Give.form.fn.getGateway(i),a[r].gateways)){var n=jQuery("<option/>",{value:r,html:a[r].currency_label});i.find(".give-cs-select-currency").append(n)}}),i.find(".give-currency-switcher-wrap").show(),u.attr("data-total",s),u.text(Give.fn.formatCurrency(s,{symbol:Give.form.fn.getInfo("currency_symbol",i),position:Give.form.fn.getInfo("currency_position",i)},i)),!Give_Currency_Switcher.module.isGatewaySupportCurrency(i,o)){if(Give_Currency_Switcher.module.showCurrencyNotSupportGatewayNotice(i,o),1!==c.length)return i.find(".give-donation-amount .give-text-input").trigger("blur"),Give_Currency_Switcher.autoSwitchCurrency(i,o),void i.find("#give-purchase-button").attr("disabled",!0);Give_Currency_Switcher.autoSwitchCurrency(i,c.find("option").val())}0<i.find('.give-cs-select-currency option[value="'+o+'"]').length?Give_Currency_Switcher.autoSwitchCurrency(i,o):0<i.find(".give-cs-select-currency").length&&(e("<span/>",{"class":"give-cs-old-exchange-rates","data-old_exchange_rates":JSON.stringify(Give_Currency_Switcher.module.getExchangeRates(i))}).appendTo(i),i.find(".give-cs-select-currency").val(Give_Currency_Switcher.module.getValueOf("give-cs-base-currency",i)).change())}},autoSwitchCurrency:function(e,r){e.find(".give-cs-select-currency").val(r).trigger("change")},remove_sanitize_amount:function(e){var r=jQuery(this).closest("form"),n=Give.form.fn.getInfo("decimal_separator",r),t=Give.fn.unFormatCurrency(r.find('input[name="give-amount"]').val(),n),i=Give.fn.unFormatCurrency(r.find(".give-cs-amount-totals").attr("data-total"),n);t!==i&&r.find(".give-cs-amount-totals").removeAttr("data-sanitize-amount data-custom_amount")},module:{getValueOf:function(e,r){r=0<r.length?r:{},e=0<e.length?e:"";var n=!1;switch(e){case"base_currency":n=r.find('*[name="give-cs-base-currency"]').val();break;case"currency_rate":n=r.find('*[name="give-cs-exchange-rate"]').val();break;case"switched_currency":n=r.find('*[name="give-cs-form-currency"]').val();break;case"acronyms":var t=jQuery.parseJSON(give_cs_json_obj);n=t["form_"+Give.form.fn.getInfo("form-id",r)].currency_acronym;break;case"give-cs-currency":case"selected-currency":n=r.find('input[name="give-cs-form-currency"]').val();break;default:n=r.find('*[name="'+e+'"]').val(),"undefined"===n?r.attr('*[data-"'+e+'"]'):""}return"undefined"!==n?n:""},setValueOf:function(e,r,n){if(0>=e.length)return!1;n=0<n.length?n:{},r=""!==r.length?r:"";var t=n.find('input[name="'+e+'"]');"undefined"!==t?t.val(r):""},getExchangeRates:function(r){var n=r?Give.form.fn.getInfo("form-id",r):0,t=jQuery.parseJSON(give_cs_json_obj),i=[];return 0!==n&&(i=t["form_"+n].exchange_rates),e.each(i,function(n,t){-1!==e.inArray(Give.form.fn.getGateway(r),t.support_gateways)&&(i[n]=t.rates)}),i},getRatesDecimalNumber:function(e,r){if(!e)return!1;var n=Give.form.fn.getInfo("form-id",e),t=jQuery.parseJSON(give_cs_json_obj),i=t["form_"+n].decimal_number;return r?i[r]:i},getCustomAmounts:function(r,n){var t=r?Give.form.fn.getInfo("form-id",r):0,i=jQuery.parseJSON(give_cs_json_obj),a=[],o=i["form_"+t].custom_amounts;return e.each(o,function(e,r){a[e]=!1,""!==n&&-1!==n&&void 0!==n?void 0!==r[n]&&!1!==r[n]&&(a[e]=r[n].raw_amount):void 0!==r.raw_amount&&(a[e]=r.raw_amount)}),a},getSupportedCurrencies:function(r){if(Give_Currency_Switcher.module.isCurrencySwitcherEnable(r)){var n=r?Give.form.fn.getInfo("form-id",r):0,t=jQuery.parseJSON(give_cs_json_obj);if("undefined"==typeof n)return[];if("undefined"!=typeof t["form_"+n].support_gateways){var i=[],a=t["form_"+n].support_gateways,o=Give.form.fn.getGateway(r);return Object.keys(a).forEach(function(r,n){-1!==e.inArray(o,a[r].gateways)&&(i[r]=a[r],i[r].currencySetting=t.supported_currency[r])}),i}}},getDonationAmount:function(e,r){e="undefined"!==e?e:{},r=r||Give.form.fn.getInfo("decimal_separator",e);var n=e.find("span.give-cs-amount-totals"),t=n.attr("data-sanitize-amount"),i=n.attr("data-custom_amount"),a=e.find('input[name="give-amount"]').val(),o="undefined"!=typeof i&&!1!==i?i:0<e.find('input[name="give-cs-custom-amount"]').length?e.find('input[name="give-cs-custom-amount"]').val():"";return 0<o?o:0<t?t:Give.fn.unFormatCurrency(a,r)},getBaseAmounts:function(e,r){var n=JSON.parse(Give.form.fn.getInfo("give_cs_base_amounts",e));return-1===r&&(r=0!==n.custom?"custom":0),n[r]},convertCurrency:function(e,r,n,t,i,a){if(t=t||Give_Currency_Switcher.module.getValueOf("give-cs-currency",r),n===t)return e;i=i||!1;const o=r.find("span.give-cs-old-exchange-rates").attr("data-old_exchange_rates"),c=Give_Currency_Switcher.module.getExchangeRates(r,!0),u=0<r.find("span.give-cs-old-exchange-rates").length&&null!==o?JSON.parse(o):c;return i?(a="undefined"==typeof a?Give.form.fn.getPriceID(r):a,e=Give_Currency_Switcher.module.getBaseAmounts(r,a)):give_global_vars.currency!==t?give_global_vars.currency!==n&&(e/=u[n]):e/=u[n],converted_amount=0<u[t]?e*u[t]:e},updateFeeAmount:function(r,n,t,i){if(0<t.find('input[name="give-fee-recovery-settings"]').length&&void 0!==typeof Give_Fee_Recovery){var a=JSON.parse(t.find('input[name="give-fee-recovery-settings"]').val());if(!1===a.fee_recovery)return;"undefined"!=typeof a.fee_data.all_gateways&&""!==a.fee_data.all_gateways.base_amount?a.fee_data.all_gateways.base_amount=Give_Currency_Switcher.module.convertCurrency(a.fee_data.all_gateways.base_amount,t,r,n):e.each(a.fee_data,function(e,i){a.fee_data[e].base_amount=Give_Currency_Switcher.module.convertCurrency(a.fee_data[e].base_amount,t,r,n)}),t.find('input[name="give-fee-recovery-settings"]').val(JSON.stringify(a)),t.find("span.give-cs-old-exchange-rates").remove(),Give_Fee_Recovery.give_fee_update(t,!0,t.find("#give-amount").val(),Give.form.fn.getGateway(t))}},getDefaultMinimumAmount:function(e,r){r=r||"min";var n=jQuery.parseJSON(give_cs_json_obj)["form_"+Give.form.fn.getInfo("form-id",e)];return"min"===r?n.minimum_amount:n.maximum_amount},updateCurrencyMessage:function(e,r){if(Give_Currency_Switcher.module.isCurrencySwitcherEnable(e)){var n=Give_Currency_Switcher.module.getCustomAmounts(e,r),t=e.find(".give-currency-switcher-msg"),i=Give.form.fn.getInfo("currency_code",e);if(null===i)return e.find("#give-purchase-button").attr("disabled",!0),!1;var a=Give_Currency_Switcher.module.getRatesDecimalNumber(e);if(n[i])t.text(give_currency_switcher.cs_custom_price_message).show();else{var o=parseFloat(e.find('input[name="give-cs-exchange-rate"]').val());0!==o&&t.text(t.data("rawtext").replace("{new_currency}",i).replace("{new_currency_rate}",Give.fn.formatCurrency(o,{precision:a[i]},e)).replace("{base_currency}",give_global_vars.currency))}give_global_vars.currency===i||0===o?e.find(".give-currency-switcher-msg-wrap").hide():e.find(".give-currency-switcher-msg-wrap").show()}},isCurrencySwitcherEnable:function(e){if("undefined"==typeof give_cs_json_obj||"null"===give_cs_json_obj)return!1;const r=jQuery.parseJSON(give_cs_json_obj),n=Give.form.fn.getInfo("form-id",e),t="form_"+n;return!!r.hasOwnProperty(t)&&jQuery.parseJSON(give_cs_json_obj)[t]},isGatewaySupportCurrency:function(r,n){var t=r?Give.form.fn.getInfo("form-id",r):0,i=jQuery.parseJSON(give_cs_json_obj);if(0===t)return!1;var a=n;"undefined"==typeof n&&(a=Give.form.fn.getInfo("currency_code",r));var o=i["form_"+t].support_gateways,c=Give.form.fn.getGateway(r),u=o[a].gateways;return-1!==e.inArray(c,u)},showCurrencyNotSupportGatewayNotice:function(r,n){r.find("#give_currency_not_support.give_notice").parent().remove(),r.find("#give-purchase-button").attr("disabled",!0),r.find(".give-currency-switcher-msg-wrap").hide();var t=n,i=r.data("currency_code");"undefined"==typeof t&&(t=i),e("<div/>",{"class":"give_notices give_errors",id:"give_error_error"}).append(e("<p/>",{"class":"give_error give_notice",id:"give_currency_not_support","data-dismissible":"1","dismiss-type":"manual"}).html(give_currency_switcher.currency_not_support_message.replace("{currency_code}",t).replace("{payment_gateway}",r.find("#give-gateway-option-"+Give.form.fn.getGateway(r)).text())+'<img class="notice-dismiss give-notice-close" src="'+give_currency_switcher.notice_dismiss_image+'">')).prependTo(r)}},chosenCurrency:function(r){if(1>=e(this).find("option").length)return r.preventDefault(),!1}},e(function(){Give_Currency_Switcher.init()})}(jQuery);